# 要件定義：AI返信サジェストChrome拡張機能

## プロジェクト概要

### 目的
Chatwork、ココナラ、ランサーズなどのビジネスチャットで、AIによる返信候補を6パターン生成し、ユーザーの返信作業を効率化する。

### 対象ユーザー
- ビジネスチャットを頻繁に使用する人
- 返信文章を考える時間を短縮したい人
- 様々なトーン（丁寧/簡潔/フレンドリー）の返信を使い分けたい人

---

## 機能要件

### 1. AI返信生成機能（コア機能）

#### 1.1 6パターン返信生成
**要件ID**: REQ-001  
**優先度**: 高

相手のメッセージに対して、以下の6パターンの返信候補を生成する：
- **short_polite**: 短く丁寧（10-20文字）
- **short_casual**: 短く簡潔（10-20文字）
- **short_friendly**: 短く親しみやすい（10-20文字）
- **long_polite**: 長く丁寧（30-50文字）
- **long_casual**: 長く簡潔（30-50文字）
- **long_friendly**: 長く親しみやすい（30-50文字）

**受入基準**:
- ✅ 6パターンすべてが意味的に異なる
- ✅ 日本語で返信（英語は不可）
- ✅ 相手のメッセージ内容を正確に理解
- ✅ 相手のトーン（敬語/タメ口）に合わせる

---

#### 1.2 62種類の会話シーン対応
**要件ID**: REQ-002  
**優先度**: 高

以下の会話シーンに対応する：

**ビジネス（10種類）**:
- 承認依頼
- 稟議報告
- 会議調整
- 資料依頼
- 謝罪対応
- 感謝表明
- 進捗報告
- 不採用通知
- 依頼の断り
- 納期確認

**日常カジュアル（15種類）**:
- 友人との雑談、趣味の話、遊びの誘い、食事の報告、買い物の相談、旅行の報告、天気の話、ペットの写真、映画の感想、音楽の共有、本の紹介、ゲームの話、ファッション、スポーツ観戦、日常報告

**感情表現（10種類）**:
- 喜びの共有、悲しみの慰め、怒りへの共感、驚きの反応、不安への励まし、感謝の受け答え、謝罪の受け入れ、寂しさへの寄り添い、嫉妬への対応、期待への応答

**家族（8種類）**:
- 日常報告、体調気遣い、おはよう/おやすみ、写真共有、旅行報告、料理の報告、孫の成長報告、感謝の伝達

**恋人（8種類）**:
- 甘え表現、デートの誘い、愛情表現、お疲れ様、心配の表現、思い出の共有、プレゼント感謝、おやすみメッセージ

**体調・気遣い（5種類）**:
- 体調不良（本人）、体調不良（第三者）、疲れへの労い、励ましの言葉、心配の返答

**イベント（6種類）**:
- 誕生日祝い、合格・昇進祝い、謝罪の受け入れ、お礼の返答、お見舞い、お悔やみへの返答

**受入基準**:
- ✅ 各シーンで適切な返信を生成
- ✅ シーン自動判別機能

---

#### 1.3 第三者話題の判別（Phase 1で実装予定）
**要件ID**: REQ-003  
**優先度**: 中（Phase 1）

第三者の話題の場合、本人に直接話しかけないように制御する。

**例**:
- ❌ 誤り: 「田中さん、お疲れ様です！」
- ✅ 正解: 「そうなんですね。田中さんは大変そうですね。」

**検出条件**:
- 「〜さん」「〜ちゃん」「〜くん」「〜みたい」「〜らしい」

**受入基準**:
- ✅ 第三者の話題を正確に検出
- ✅ 話し手に対する返信を生成

---

### 2. 対応サイト

#### 2.1 Chatwork対応
**要件ID**: REQ-004  
**優先度**: 高

- ✅ メッセージ抽出
- ✅ テキストボックス自動挿入
- ✅ 拡張機能UI表示

#### 2.2 ココナラ対応
**要件ID**: REQ-005  
**優先度**: 高

（同上）

#### 2.3 ランサーズ対応
**要件ID**: REQ-006  
**優先度**: 高

（同上）

---

### 3. 定型文・履歴機能

#### 3.1 定型文管理
**要件ID**: REQ-007  
**優先度**: 中

- ✅ 定型文の追加・削除・編集
- ✅ ドラッグ&ドロップで並び替え
- ✅ プレースホルダー機能（{{zoom}}, {{meet}}, {{teams}}）
- ✅ 検索機能

#### 3.2 履歴管理
**要件ID**: REQ-008  
**優先度**: 中

- ✅ クリップボード履歴を自動保存（最大30件、24時間）
- ✅ VSCode、秀丸、EmEditorなどからの自動取得
- ✅ 履歴→定型文への変換（ドラッグ&ドロップ）

#### 3.3 バックアップ・復元
**要件ID**: REQ-009  
**優先度**: 低

- ✅ CSV/JSONエクスポート
- ✅ CSV/JSON自動判別インポート
- ✅ バックアップ警告バナー

---

### 4. AI精度向上（Phase 0完了）

#### 4.1 Few-shot学習
**要件ID**: REQ-010  
**優先度**: 高

- ✅ 6つの成功例を学習
- ✅ 返信精度15-20%向上

#### 4.2 Chain-of-Thought推論
**要件ID**: REQ-011  
**優先度**: 高

- ✅ 段階的思考プロセス（シーン判別→意図理解→トーン設定→差異化→最終チェック）
- ✅ 文脈理解30%向上

#### 4.3 OpenRouter構造化出力
**要件ID**: REQ-012  
**優先度**: 高

- ✅ JSON Schemaで型安全な応答
- ✅ エラー率50%削減

---

## 非機能要件

### 5. パフォーマンス

#### 5.1 応答速度
**要件ID**: REQ-013  
**優先度**: 中

- 目標: 2秒以内でAI返信を生成
- API呼び出し最適化

#### 5.2 キャッシュシステム（Phase 1予定）
**要件ID**: REQ-014  
**優先度**: 中

- メモリキャッシュ（5分）
- ストレージ永続化
- API呼び出し50%削減

---

### 6. セキュリティ

#### 6.1 プライバシー保護
**要件ID**: REQ-015  
**優先度**: 高

- ✅ 個人情報の収集なし
- ✅ データ保存はブラウザ内（chrome.storage.sync）のみ
- ✅ OpenRouter APIへの送信のみ（返信生成時）

#### 6.2 APIキー管理
**要件ID**: REQ-016  
**優先度**: 高

- ✅ ユーザーが自分のAPIキーを設定
- ✅ セキュアな保存（chrome.storage.sync）

---

## 技術要件

### 7. 技術スタック

#### 7.1 プラットフォーム
**要件ID**: REQ-017  
**優先度**: 高

- Chrome拡張機能 Manifest V3
- JavaScript/ES6+

#### 7.2 AI API
**要件ID**: REQ-018  
**優先度**: 高

- OpenRouter API
- デフォルトモデル: `google/gemma-2-9b-it:free`
- 有料版オプション: `google/gemma-2-9b-it`（月約30円）

#### 7.3 モジュール構成（Phase 0完了）
**要件ID**: REQ-019  
**優先度**: 高

```
ai/
├── core/          (ai-service.js, context-analyzer.js)
├── prompts/       (prompt-builder.js, few-shot-examples.js, chain-of-thought.js, base-prompt.js)
└── utils/         (json-schema.js, validator.js)
```

---

## 制約条件

### 8. 制約

#### 8.1 コスト
- 無料版（`:free`）を推奨
- 有料版は月30円程度

#### 8.2 対応ブラウザ
- Chrome/Chromium系ブラウザのみ
- Brave対応（要設定）

#### 8.3 依存関係
- Node.js不要（Chrome拡張機能のみ）
- 外部ライブラリ最小限

---

## 将来の拡張（Phase 1/2）

### Phase 1: 部分モジュール化（1週間）
**要件ID**: REQ-020  
**優先度**: 中

- Scene Manager作成（62シーンを個別ファイルに分離）
- 第三者話題15シーンの追加
- キャッシュシステム導入

### Phase 2: 完全リファクタリング（4-6週間）
**要件ID**: REQ-021  
**優先度**: 低

- Response Generator
- Conversation History Manager
- パフォーマンス最適化
- 品質保証・セキュリティ強化

---

## 受入基準（全体）

### 機能受入基準
- ✅ Chatwork/ココナラ/ランサーズで動作
- ✅ 6パターンの返信生成（日本語のみ）
- ✅ トーンの適切な使い分け
- ✅ 定型文・履歴機能が正常動作

### 品質受入基準
- ✅ 返信精度: Phase 0で15-30%向上
- ✅ エラー率: 50%削減
- ✅ ユーザーテスト: 10名以上で評価

---

## 成功指標（KPI）

### 定量指標
- 返信生成時間: 2秒以内
- AI精度: ユーザー満足度80%以上
- エラー率: 5%以下

### 定性指標
- ユーザーからの「使いやすい」フィードバック
- 複数の会話シーンでの動作確認
